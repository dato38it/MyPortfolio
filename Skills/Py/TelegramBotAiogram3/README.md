# Telegram bot
<p>strong>Task:</strong><br>Создать бот<br><strong>Decision:</strong><br>- BotFather - /start - /newbot - Tbot - tnlobot<br>$ touch config.py<br>$ touch run.py<br>$ python -m venv .venv<br>$ source venv/bin/activate<br>$ pip install aiogram==3.3.0<br>$ vim run.py<br>$ cat run.py<br>TOKEN='7153496019:AAG0XeyOSWEf8c8-k_9USF7ZIT7QXjM1BS4'<br>$ vim config.py<br>$ cat config.py<br>import asyncio<br>import logging<br>from aiogram import Bot, Dispatcher<br>from aiogram.filters import CommandStart<br>from aiogram.types import Message<br>from config import TOKEN<br>bot = Bot(token=TOKEN)<br>dp = Dispatcher()<br>@dp.message(CommandStart())<br>async def cmd_start(message: Message):<br>&nbsp;&nbsp;await message.answer('Hello!')<br>async def main():<br>&nbsp;&nbsp;await dp.start_polling(bot)<br>if __name__ == '__main__':<br>&nbsp;&nbsp;logging.basicConfig(level=logging.INFO)<br>&nbsp;&nbsp;try:<br>&nbsp;&nbsp;&nbsp;&nbsp;asyncio.run(main())<br>&nbsp;&nbsp;except KeyboardInterrupt:<br>&nbsp;&nbsp;&nbsp;&nbsp;print('Exit')<br>$ python run.py<br>- Tbot - /start<br>Hello!<br><strong>Task:</strong><br>Фильтры и работа с сообщениями<br><strong>Decision:</strong><br>$ vim run.py<br>$ cat run.py<br>...<br>from aiogram import Bot, Dispatcher, F<br>from aiogram.filters import CommandStart, Command<br>...<br>dp = Dispatcher()<br>@dp.message(CommandStart())<br>async def cmd_start(message: Message):<br>&nbsp;&nbsp;#await message.answer('Hello!')<br>&nbsp;&nbsp;await message.reply(f'Hello!\nYour ID: {message.from_user.id}\nName: {message.from_user.first_name}')<br>@dp.message(Command('help'))<br>async def get_help(message: Message):<br>&nbsp;&nbsp;await message.answer('Это команда /help')<br>@dp.message(F.text == 'How are you?')<br>async def how_are_you(message: Message):<br>&nbsp;&nbsp;await message.answer('OK!')<br>@dp.message(Command('get_photo'))<br>async def get_photo(message: Message):<br>&nbsp;&nbsp;await message.answer_photo(photo='AgACAgIAAxkBAAPsZlP3igSjG_3--JZWdX6brnm8ahUAAs3dMRvFfaBKymNpE90S-VcBAAMCAAN4AAM1BA',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   caption='Это график')<br>@dp.message(F.photo)<br>async def get_photo(message: Message):<br>&nbsp;&nbsp;await message.answer(f'ID photo: {message.photo[-1].file_id}')<br>async def main():<br>...<br>$ python run.py<br>- Tbot - /start<br>Hello!<br>Your ID: 1064831036<br>Name: David<br>- help<br>Это команда /help<br>- How are you?<br>OK!<br>- photo.jpg<br>ID photo: AgACAgIAAxkBAAPsZlP3igSjG_3--JZWdX6brnm8ahUAAs3dMRvFfaBKymNpE90S-VcBAAMCAAN4AAM1BA<br>- /get_photo<br>photo.jpg<br>Это график<br><strong>Task:</strong><br>Роутеры и структура Telegram бота<br><strong>Decision:</strong><br>$ mkdir app<br>$ touch app/handlers.py<br>$ vim app/handlers.py<br>$ cat app/handlers.py<br>from aiogram import F, Router<br>from aiogram.filters import CommandStart, Command<br>from aiogram.types import Message<br>router = Router()<br>@router.message(CommandStart())<br>async def cmd_start(message: Message):<br>&nbsp;&nbsp;#await message.answer('Hello!')<br>&nbsp;&nbsp;await message.reply(f'Hello!\nYour ID: {message.from_user.id}\nName: {message.from_user.first_name}')<br>@router.message(Command('help'))<br>async def get_help(message: Message):<br>&nbsp;&nbsp;await message.answer('Это команда /help')<br>@router.message(F.text == 'How are you?')<br>async def how_are_you(message: Message):<br>&nbsp;&nbsp;await message.answer('OK!')<br>@router.message(Command('get_photo'))<br>async def get_photo(message: Message):<br>&nbsp;&nbsp;await message.answer_photo(photo='AgACAgIAAxkBAAPsZlP3igSjG_3--JZWdX6brnm8ahUAAs3dMRvFfaBKymNpE90S-VcBAAMCAAN4AAM1BA',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   caption='Это график')<br>@router.message(F.photo)<br>async def get_photo(message: Message):<br>&nbsp;&nbsp;await message.answer(f'ID photo: {message.photo[-1].file_id}')<br>$ vim run.py<br>$ cat run.py<br>import asyncio<br>import logging<br>from aiogram import Bot, Dispatcher<br>from config import TOKEN<br>from app.handlers import router<br>bot = Bot(token=TOKEN)<br>dp = Dispatcher()<br>async def main():<br>&nbsp;&nbsp;dp.include_router(router)<br>&nbsp;&nbsp;await dp.start_polling(bot)<br>if __name__ == '__main__':<br>&nbsp;&nbsp;logging.basicConfig(level=logging.INFO)<br>&nbsp;&nbsp;try:<br>&nbsp;&nbsp;&nbsp;&nbsp;asyncio.run(main())<br>&nbsp;&nbsp;except KeyboardInterrupt:<br>&nbsp;&nbsp;&nbsp;&nbsp;print('Exit')<br><strong>Task:</strong><br>Клавиатура в Телеграм Ботах - Inline Reply и Builder<br><strong>Decision:</strong><br>$ touch app/keyboards.py<br>$ vim app/keyboards.py<br>$ cat app/keyboards.py<br>from aiogram.types import (ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardMarkup, InlineKeyboardButton)<br>from aiogram.utils.keyboard import ReplyKeyboardBuilder, InlineKeyboardBuilder<br>main = ReplyKeyboardMarkup(keyboard=[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[KeyboardButton(text='Catalog')],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[KeyboardButton(text='Корзина'), KeyboardButton(text='Contacts')]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resize_keyboard=True,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_field_placeholder='Выберите пункт меню')<br>settings = InlineKeyboardMarkup(inline_keyboard=[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[InlineKeyboardButton(text='Youtube', url='https://youtube.com/@sudoteach')]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])<br>cars = ['Tesla', 'Mesredes', 'BMW']<br>async def inline_cars():<br>&nbsp;&nbsp;keyboard = InlineKeyboardBuilder()<br>&nbsp;&nbsp;for car in cars:<br>&nbsp;&nbsp;&nbsp;&nbsp;keyboard.add(InlineKeyboardButton(text=car, url='https://youtube.com/@sudoteach'))<br>&nbsp;&nbsp;return keyboard.adjust(2).as_markup()<br>$ vim app/handlers.py<br>$ cat app/handlers.py<br>...<br>import app.keyboards as kb<br>router = Router()<br>@router.message(CommandStart())<br>async def cmd_start(message: Message):<br>&nbsp;&nbsp;#await message.answer('Hello!')<br>&nbsp;&nbsp;#await message.reply(f'Hello!\nYour ID: {message.from_user.id}\nName: {message.from_user.first_name}')<br>&nbsp;&nbsp;await message.reply(f'Hello!\nYour ID: {message.from_user.id}\nName: {message.from_user.first_name}', <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#reply_markup=kb.settings)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reply_markup=await kb.inline_cars())<br>...<br>$ python run.py<br>- /start<br>Your ID: 1064831036<br>Name: David<br>Tesla Mesredes BMW<br>- Mesredes<br>Do you what to open https://youtube.com/@sudoteach?<br><strong>Task:</strong><br>CallbackQuery<br><strong>Decision:</strong><br>$ vim app/keyboards.py<br>$ cat app/keyboards.py<br>...<br>#main = ReplyKeyboardMarkup(keyboard=[<br>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[KeyboardButton(text='Catalog')],<br>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[KeyboardButton(text='Корзина'), KeyboardButton(text='Contacts')]<br>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resize_keyboard=True,<br>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_field_placeholder='Выберите пункт меню')<br>main = InlineKeyboardMarkup(inline_keyboard=[<br>&nbsp;&nbsp;[InlineKeyboardButton(text='Catalog', callback_data='catalog')],<br>&nbsp;&nbsp;[InlineKeyboardButton(text='Basket', callback_data='basket'),<br>&nbsp;&nbsp; InlineKeyboardButton(text='Contacts', callback_data='contacts')]<br>])<br>...<br>$ vim app/handlers.py<br>$ cat app/handlers.py<br>...<br>from aiogram.types import Message, CallbackQuery<br>import app.keyboards as kb<br>router = Router()<br>@router.message(CommandStart())<br>async def cmd_start(message: Message):<br>&nbsp;&nbsp;#await message.answer('Hello!')<br>&nbsp;&nbsp;#await message.reply(f'Hello!\nYour ID: {message.from_user.id}\nName: {message.from_user.first_name}')<br>&nbsp;&nbsp;await message.reply(f'Hello!\nYour ID: {message.from_user.id}\nName: {message.from_user.first_name}', <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#reply_markup=kb.settings)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#reply_markup=await kb.inline_cars())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reply_markup=kb.main)<br>...<br>@router.callback_query(F.data == 'catalog')<br>async def catalog(callback: CallbackQuery):<br>&nbsp;&nbsp;await callback.answer('Вы выбрали каталог', show_alert=True)<br>&nbsp;&nbsp;await callback.message.edit_text('Hey!', reply_markup=await kb.inline_cars())<br>$ python run.py<br>- /start <br>Helo!<br>Your ID: 1064831036<br>Name: David<br>Catalog Basket Contacts<br>- Catalog<br>Вы выбрали каталог!<br>Hey!<br>Tesla Mesredes BMW<br>- Mesredes<br>Do you what to open https://youtube.com/@sudoteach?<br><strong>Task:</strong><br>FSM Context - машина состояний<br><strong>Decision:</strong><br>$ vim app/handlers.py<br>$ cat app/handlers.py<br>...<br>from aiogram.fsm.state import StatesGroup, State<br>from aiogram.fsm.context import FSMContext<br>import app.keyboards as kb<br>router = Router()<br>class Reg(StatesGroup):<br>&nbsp;&nbsp;name = State()<br>&nbsp;&nbsp;number = State()<br>...<br>@router.message(Command('reg'))<br>async def reg_one(message: Message, state: FSMContext):<br>&nbsp;&nbsp;await state.set_state(Reg.name)<br>&nbsp;&nbsp;await message.answer('Введите ваше имя')<br>@router.message(Reg.name)<br>async def reg_two(message: Message, state: FSMContext):<br>&nbsp;&nbsp;await state.update_data(name=message.text)<br>&nbsp;&nbsp;await state.set_state(Reg.number)<br>&nbsp;&nbsp;await message.answer('Введите ваш телефон')<br>@router.message(Reg.number)<br>async def two_three(message: Message, state: FSMContext):<br>&nbsp;&nbsp;await state.update_data(number=message.text)<br>&nbsp;&nbsp;data = await state.get_data()<br>&nbsp;&nbsp;await message.answer(f'Спасибо,регистрация завершена.\nName: {data["name"]}\nNumber: {data["number"]}')<br>&nbsp;&nbsp;await state.clear()<br>$ python run.py<br>- /start<br>Helo!<br>Your ID: 1064831036<br>Name: David<br>Catalog Basket Contacts<br>- /reg<br>Введите ваше имя<br>tuser<br>Введите ваш телефон<br>564564<br>Спасибо,регистрация завершена.<br>Name: tuser<br>Number: 564564<br><strong>Task:</strong><br>Middleware<br><strong>Decision:</strong><br>$ touch app/middlewares.py<br>$ vim app/middlewares.py<br>$ cat app/middlewares.py<br>from aiogram import BaseMiddleware<br>from aiogram.types import TelegramObject<br>from typing import Callable, Dict, Any, Awaitable<br>class TestMiddleware(BaseMiddleware):<br>&nbsp;&nbsp;async def __call__(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler: Callable[[TelegramObject, Dict[str, Any]], Awaitable[Any]],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event: TelegramObject,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data: Dict[str, Any]<br>&nbsp;&nbsp;) -&gt; Any:<br>&nbsp;&nbsp;&nbsp;&nbsp;print('Действия до обработчика')<br>&nbsp;&nbsp;&nbsp;&nbsp;result = await handler(event, data)<br>&nbsp;&nbsp;&nbsp;&nbsp;print('Действия после обработчика')<br>&nbsp;&nbsp;&nbsp;&nbsp;return result<br>$ vim app/handlers.py<br>$ cat app/handlers.py<br>...<br>from app.middlewares import TestMiddleware<br>router = Router()<br>router.message.outer_middleware(TestMiddleware())<br>...<br>$ python run.py<br>- /start<br>Helo!<br>Your ID: 1064831036<br>Name: David<br>Catalog Basket Contacts<br>Действия до обработчика<br>Действия после обработчика<br>- gfhfgh<br>Действия до обработчика<br>Действия после обработчика<br><strong>Source:</strong><br>AIOGRAM 3 ПОЛНЫЙ КУРС - https://www.youtube.com/playlist?list=PLV0FNhq3XMOJ31X9eBWLIZJ4OVjBwb-KM</p>
